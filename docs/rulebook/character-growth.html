<!-- v1.17 2025-08-15T13:37:38.963Z -->

<!DOCTYPE html>
<html lang="en" data-env="github" class="preload">

<head>
    <!-- Charset -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Seeker TTRPG • Character Growth</title>

    <meta name="description"
        content="Seeker is a tabletop role‑playing game set in an alternate Age of Discovery, where colonial ambition awakens forgotten entities and fractured ley‑lines. As a Seeker/Buscador—explorer, scholar, heretic—you cross an ocean into lands that observe you as intently as you chart them." />

    <meta name="author" content="Alonso de Luna" />

    <!-- Favicon (opzionale) -->
    <link rel="icon" href="/assets/icons/ico/favicon.ico" type="image/ico" />

    <!-- Open Graph per link preview -->
    <meta property="og:title" content="Seeker TTRPG" />
    <meta property="og:description"
        content="Explore a haunted New World in the Age of Discovery, where supernatural entities awaken with conquest." />
    <meta property="og:image" content="/assets/preview.png" />
    <meta property="og:url" content="https://www.seekerttrpg.com" />
    <meta property="og:type" content="website" />

    <!-- Twitter Card preview -->
    <meta name="twitter:card" content="summary_large_image" />

    <!-- IE Compatibility -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script src="/scripts/config.js"></script>

    <link rel="stylesheet" href="/style/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .xp-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin: 1rem 0;
        }

        @media (max-width: 700px) {
            .xp-grid {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        .xp-card {
            background: #484848;
            border-radius: 8px;
            padding: 1.2rem;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, .4);
        }

        .xp-card:hover {
            background-color: rgba(59, 59, 59, 0.85);
            transform: scale(1.05);
        }

        .xp-icon {
            width: 40px;
            height: 40px;
            margin-bottom: .2rem;
        }

        .xp-title {
            margin: .2rem 0 .4rem 0;
            font-size: .9rem;
            text-transform: uppercase;
        }

        .advancement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .advancement-col {
            flex: 1 1 30%;
            background: var(--background-grey-1), #3b3b3b;
            border: 1px solid var(--deep-charcoal);
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            padding: .5rem;
        }

        .advancement-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            min-height: auto;
            text-align: center;
            padding: .3rem;
        }

        .advancement-header h4 {
            margin: 0;
            font-size: .9rem;
            text-transform: uppercase;
            line-height: 1.3;
        }

        .advancement-col:hover {
            background: #494949;
            transition: all 0.2s ease-in-out;
        }

        .xp-table {
            margin: 0;
        }

        /* OVERRIDES */
        .collapsible-header {
            border-radius: 8px;
        }

        .collapsible-header:hover {
            border-radius: 8px;
        }

        .collapsible-item {
            background: #3b3b3b;
            box-shadow: none;
        }

        .collapsible-icon {
            color: var(--ancient-gold, #D4B55A);
        }

        .collapsible-content.expanded-content {
            padding: 0;
        }

        .xp-table td:first-child {
            color: var(--off-white, #f0f0f0);
            font-weight: 400;
        }

        .xp-table th:first-child {
            text-align: left;
        }

        .xp-table td {
            color: var(--ancient-gold, #D4B55A);
            font-weight: 600;
        }

        .advancement-list {
            text-align: left;
            padding-left: 1rem;
            margin-top: 0.5rem;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .advancement-list li {
            margin-bottom: 0.4rem;
        }

        .advancement-boost {
            color: var(--ancient-gold, #D4B55A);
            font-weight: bold;
        }

        .adv-grid {
            display: grid;
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .adv-card {
            background: #484848;
            border: 1px solid #444;
            border-radius: 1rem;
            padding: 1.5rem;
            min-width: 300px;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.4);
        }

        .adv-title {
            font-size: 1.25rem;
            margin: 1rem 0;
            text-align: center;
        }

        .adv-icon {
            width: 48px;
            height: 48px;
            display: block;
            margin: 0 auto;
        }

        .advancement-option {
            border: 1px solid #555;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: #2b2b2b;
            display: block;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
            font-size: .9rem;
        }

        .advancement-option:hover {
            border-color: var(--ancient-gold, #D4B55A);
            background-color: var(--background-grey-1, #484848);
        }

        .apt-icon {
            width: 1.5rem;
            height: 1.5rem;
            vertical-align: middle;
        }

        .advancement-boost {
            font-weight: bold;
            color: #d4b55a;
        }

        .adv-subtitle {
            font-size: .9rem;
            color: var(--text-muted, #bbbbbb);
            margin: 0.5em 0 1em;
            line-height: 1.5;
            text-align: center;
        }

        .spend-xp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: .5em;
            margin-top: 1em;
            padding-bottom: 1em;
            align-items: stretch;
            text-align: center;
        }

        .spend-xp-card {
            min-width: 220px;
            min-height: 380px;
            background: linear-gradient(to right,
                    rgba(var(--burnt-copper-rgb), 0.2),
                    rgba(var(--ancient-gold-rgb), 0.2)),
                url(/assets/textures/antique-gold-1.jpg);
            border-radius: 0.6rem;
            background-size: cover;
            background-blend-mode: overlay;
            padding: 2px;
        }

        .spend-xp-card-inner {
            padding: 1rem 1.2rem;
            border-radius: .5rem;
            cursor: var(--cursor-pointer);
            transition: transform 0.2s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
            background-blend-mode: overlay;
            background-color: rgba(25, 25, 25, 1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
            min-height: 190px;
        }
    </style>
</head>

<body id="aptitudes" data-menu-src="/data/menu-rulebook.json">
    <!-- SIDENAV -->
    <div id="sidenav-container"></div>
    <!-- NAVBAR -->
    <div id="navbar-top"></div>
    <script src="/scripts/navbar.js"></script>

    <!-- MAIN CONTENT ───────────────────────────────────────────── -->

    <main class="dual-column" type="rulebook">
        <div class="left-column">
            <header class="title">
                <div class="title-container page-title">
                    <span class="title-icon">l</span>
                    <h1>Character Growth</h1>
                    <span class="title-icon rot90">l</span>
                </div>
            </header>
            <!-- ─────────────── MAIN CONTENT ─────────────── -->
            <!-- 1 • Core Concept -->
            <section class="section-wrapper" id="section1" sidenav="1 • Core Concept">
                <header class="section var-1">
                    <div class="section-number">
                        <p>Section I</p>
                    </div>
                    <div class="title-container">
                        <span class="title-icon">r</span>
                        <h2>Core Concept</h2>
                        <span class="title-icon rot90">r</span>
                    </div>
                    <p class="subtitle">Progression through Three Tracks of Play
                    </p>
                </header>

                <p>In Seeker, growth is not linear—it is lived. Your character does not simply accumulate a universal XP
                    number until they “level-up.” Instead, they grow through action and specialization, gaining power in
                    the
                    areas where they take risks and make impact.</p>
                <p>Experience is divided into <span class="highlight">three distinct <strong>Tracks</strong></span>,
                    each representing a core axis of
                    gameplay. These Tracks progress independently. You don’t level up in general—you level up in what
                    you
                    do.</strong>:</p>

                <div class="xp-grid">
                    <!-- Combat -->
                    <div class="xp-card">
                        <img src="https://static.wixstatic.com/shapes/e40a82_74fa6857d47846daae5961eae3b49c2e.svg"
                            alt="CXP icon" class="xp-icon">
                        <h3 class="xp-title">Combat XP&nbsp;(<strong class="highlight">CXP</strong>)</h3>
                        <p>Earned by battles, tactics, and surviving danger.</p>
                    </div>

                    <!-- Social -->
                    <div class="xp-card">
                        <img src="https://static.wixstatic.com/shapes/e40a82_755ab1971b9d4d0a9987def711bbd6e5.svg"
                            alt="SXP icon" class="xp-icon">
                        <h3 class="xp-title">Social XP&nbsp;(<strong class="highlight">SXP</strong>)</h3>
                        <p>Gained through persuasion, diplomacy, and relationships.</p>
                    </div>

                    <!-- Exploration -->
                    <div class="xp-card">
                        <img src="https://static.wixstatic.com/shapes/e40a82_b5adb8850fbc4454988c07110cab632c.svg"
                            alt="EXP icon" class="xp-icon">
                        <h3 class="xp-title">Exploration XP&nbsp;(<strong class="highlight">EXP</strong>)</h3>
                        <p>Awarded for discovery, lore, travel, and investigation.</p>
                    </div>
                </div>

                <h3>Independent Progression</h3>
                <p>Each Track—Combat, Social, and Exploration—has its own XP pool. You earn XP only in the Tracks
                    relevant to your actions. XP is then spent to purchase specific improvements tied to that Track: new
                    abilities, skill upgrades, attribute increases, and more.</p>
                <p>A Seeker might have invested most of their XP into Exploration, mastering navigation and survival,
                    while leaving their Combat XP unspent. This asymmetry reflects organic, choice-driven
                    development—not a rigid class or leveling path.</p>
            </section>

            <!-- 2 • Earning XP -->
            <section class="section-wrapper" id="section2" sidenav="2 • Earning XP">
                <header class="section var-2">
                    <div class="section-number">
                        <p>Section II</p>
                    </div>
                    <div class="title-container">
                        <span class="title-icon">j</span>
                        <h2>Earning XP</h2>
                        <span class="title-icon rot90">j</span>
                    </div>
                    <p class="subtitle">Placeholder</p>
                </header>

                <p>At the end of each gaming session, or upon reaching significant narrative milestones (such as
                    completing
                    a major quest, overcoming a difficult challenge, or achieving a personal character goal), the Game
                    Master (GM) evaluates the players’ actions and contributions. The GM then awards Experience Points
                    (XP)
                    individually in each of the three Tracks — Combat, Social, and Exploration — reflecting the specific
                    areas where the characters made meaningful impact.</p>

                <p>XP awards typically range from 0 to 3 points per Track per session or milestone, depending on the
                    importance, difficulty, and relevance of the actions taken. For example: a daring battle might merit
                    full XP in Combat, while minor skirmishes earn fewer points. Similarly, successful negotiations or
                    insightful discoveries grant XP in the Social or Exploration Tracks respectively.</p>

                <p>This flexible system allows the GM to tailor rewards based on the story’s flow and the players’
                    focus,
                    encouraging characters to develop along the lines of their choices and playstyle rather than through
                    arbitrary point accrual. It is important to note that XP awards are cumulative and independent for
                    each
                    Track, supporting asymmetrical character growth.</p>

                <p>Use the sample breakdown tables below as a guideline to help calibrate your XP distribution
                    consistently
                    and fairly.</p>

                <div id="filters">
                    <label><input type="checkbox" value="CXP" checked> CXP</label>
                    <label><input type="checkbox" value="SXP" checked> SXP</label>
                    <label><input type="checkbox" value="EXP" checked> EXP</label>
                </div>

                <input type="text" id="searchInput" placeholder="Search events..."
                    style="margin-bottom: 1rem; width: 100%; padding: 8px;">

                <div id="tablesContainer"></div>
            </section>


            <!-- 3 • Spending XP -->
            <section class="section-wrapper" id="section3" sidenav="3 • Spending XP">
                <header class="section var-3">
                    <div class="section-number">
                        <p>Section III</p>
                    </div>
                    <div class="title-container">
                        <span class="title-icon">h</span>
                        <h2>Spending XP</h2>
                        <span class="title-icon rot90">h</span>
                    </div>
                    <p class="subtitle">Placeholder.</p>
                </header>


                <p>Each Track—Combat, Social, and Exploration—has its own XP pool. XP earned in one Track can only be
                    spent on that Track’s upgrades. There are no thresholds or levels: instead, players purchase
                    improvements directly.</p>

                <p>Spending XP represents deliberate training, personal growth, or mastery earned through experience.
                    Purchases should be made during downtime or other logical breaks in the narrative.</p>


                <h4>Asymmetrical Growth</h4>
                <p>Because XP is awarded and spent per Track, a Seeker’s growth will naturally be uneven. One character
                    may have poured most of their points into Combat while another becomes a master of exploration. This
                    asymmetry is a feature, not a flaw—it reflects the paths taken and risks embraced.</p>

                <p>Every new Level gained in a Track grants an Advancement—a player-chosen benefit from that Track’s
                    menu.
                    Advancements may include Aptitude increases, new abilities, combat maneuvers, exploration
                    skills, social
                    tools, or unique perks tied to the character’s growth. Each Advancement represents a tangible,
                    thematic
                    evolution of the Seeker’s capabilities.</p>
                <p>Every new level unlocks an <strong>Advancement</strong>—a choice from that Track’s menu.</p>

                <div class="spend-xp-grid">

                    <div class="spend-xp-card">
                        <div class="spend-xp-card-inner" data-title="Strength" data-category="Combat">
                            <div class="card-top">
                                <div class="aptitude-symbol-wrapper"> <img
                                        src="/assets/icons/webp/aptitudes/strength-symbol.webp" class="xp-track-symbol">
                                </div>
                            </div>
                            <div class="card-bottom">
                                <h3 class="card-title xp-track">Combat Track</h3>
                                <p class="xp-track-description">YOu may spend CXP in the following trainings:</p>
                            </div>
                        </div>
                    </div>

                </div>

            </section>

            <!-- 4 • Respec & Retraining -->
            <section class="section-wrapper" id="section4" sidenav="4 • Respec & Retraining">
                <header class="section var-4">
                    <div class="section-number">
                        <p>Section IV</p>
                    </div>
                    <div class="title-container">
                        <span class="title-icon">n</span>
                        <h2 style="font-size: clamp(3rem, 6.5vw, 3.5rem);">Respec & Retraining</h2>
                        <span class="title-icon rot90">n</span>
                    </div>
                    <p class="subtitle">Different ways to explore the New World — from quick missions to epic
                        campaigns.
                    </p>
                </header>

                <p><strong>Characters evolve.</strong> After a major narrative event (months of study, a crisis of
                    faith, etc.), the GM may allow a character to trade one advancement for another in the same
                    tier.
                </p>

                <p>This process—known as <em>retraining</em>—represents deliberate change, whether prompted by
                    spiritual
                    revelation, physical hardship, or shifting loyalties. It’s not casual or frequent, but it
                    reflects
                    the dynamic nature of Seekers as they respond to the world.</p>

                <h3>When to Allow Retraining</h3>
                <p><strong>Respec is a narrative milestone, not a transactional mechanic.</strong> It should feel
                    earned. Some examples include:</p>
                <ul>
                    <li>The character has spent weeks studying with a new mentor or tradition.</li>
                    <li>A traumatic event changes the character’s beliefs or fighting style.</li>
                    <li>The group enters a new region that demands different aptitudes.</li>
                    <li>The character voluntarily retires a philosophy, faction, or role.</li>
                </ul>
                <p>Retraining should not happen during short rests or between minor scenes. The change should be
                    justified through roleplay and integrated into the story.</p>

                <h3>What Can Be Retrained</h3>
                <p>Players may trade <strong>one advancement for another of the same type</strong>, within the same
                    <strong>Track</strong> and <strong>Tier</strong>. For example:
                </p>
                <ul>
                    <li>Swap a Social Skill like <u>Support</u> for another like <u>Influence</u>.</li>
                    <li>Replace a Combat Mastery with a different one.</li>
                    <li>Exchange +1 to an Aptitude for +1 to another within that Track.</li>
                </ul>

                <blockquote class="rules-note">
                    <p><strong>Important:</strong> Players cannot respec across Tracks (e.g., trading a Combat Skill
                        for a
                        Social Skill), nor change their total XP.</p>
                </blockquote>

                <h4>GM Guidance</h4>
                <p>As GM, you are the final judge of when a retraining opportunity is appropriate. Use it to:</p>
                <ul>
                    <li>Reflect character growth or internal conflict.</li>
                    <li>Reinforce consequences of major narrative beats.</li>
                    <li>Keep players engaged if they regret a previous build choice.</li>
                </ul>
                <p><em>Optional:</em> Consider requiring a short side quest, cost, or ritual to mark the
                    transition—especially if the change affects faction ties or magical philosophies.</p>
            </section>

            <!-- 5 • Extensions -->
            <section class="section-wrapper" id="section5" sidenav="5 • Extensions">
                <header class="section var-5">
                    <div class="section-number">
                        <p>Section V</p>
                    </div>
                    <div class="title-container">
                        <span class="title-icon left">r</span>
                        <h2>Extensions</h2>
                        <span class="title-icon right rot90">r</span>
                    </div>
                    <p class="subtitle">Placeholder.</p>
                </header>

                <p>The following optional rules expand the Level & Experience rule, offering greater narrative
                    granularity,
                    dramatic
                    tension, or strategic depth. Use them individually or mix and match to suit your table’s tone
                    and
                    playstyle.
                </p>

                <!-- ─────────────── RULE OPTIONS BOX ─────────────── -->
                <div class="rule-options-box">
                    <div class="rule-options-label">Rule Options</div>

                    <div class="toggle-bar">

                        <label class="rule-switch">
                            <input type="checkbox" data-rule="degrees-of-success" checked />
                            <span class="slider"></span>
                            <span class="label">XP Loss</span>
                            <span class="state-tag optional tooltip" data-tooltip-key="optional-rule">
                                Optional
                            </span>
                        </label>

                    </div>
                </div>

                <div class="rule-degrees-of-success">
                    <h3 class="tagged">1. XP Loss<span class="state-tag optional tooltip"
                            data-tooltip-key="optional-rule">
                            Optional
                        </span></h3>
                    <p>In rare circumstances, a Seeker may suffer <strong>XP Loss</strong>—a symbolic and mechanical
                        setback that marks failure, trauma, or a radical turning point.</p>

                    <p>XP Loss is always GM-approved and driven by narrative. It may represent the loss of
                        knowledge, social standing, or physical prowess, rather than literal memory loss.</p>

                    <h4>When XP Loss Might Apply</h4>
                    <p>While XP Loss is an optional rule, it can be a powerful narrative tool to represent moments
                        of downfall, trauma, or transformation. These are not minor setbacks—they mark turning
                        points in a character's journey, when something is truly lost, broken, or left behind.</p>
                    <ul>
                        <li>The character is <strong>defeated, captured, or maimed</strong> during a critical scene,
                            leaving lasting scars.</li>
                        <li>A betrayal or catastrophic failure causes the character to <strong>lose confidence or
                                reputation</strong> among allies and factions.</li>
                        <li>The character is <strong>excommunicated from a faction</strong> or <strong>abandons
                                their code</strong>, severing ties with a foundational belief.</li>
                        <li>A magical curse or mind-altering experience <strong>rewrites their
                                capabilities</strong>, fragmenting memory or skill.</li>
                    </ul>


                    <h4>How XP Loss Works</h4>
                    <ul>
                        <p>The player loses <strong>1–3 XP</strong> in a specific <strong>Track</strong> (Combat,
                            Social, or Exploration).</p>
                        <p>XP Loss cannot cause a character to drop below their current Level.
                    </ul>

                    <blockquote class="rules-note">
                        <p>XP Loss is not meant to punish, but to mark the weight of consequence and transformation
                            in a mutable world.</p>
                    </blockquote>
                </div>

            </section>
        </div>

        <div class="right-column">
            <aside class="sidebar-wrapper">
                <!-- Block 1: Quick Glossary Search -->
                <div class="sidebar-block">
                    <h3>Quick Glossary</h3>
                    <input type="text" id="glossary-search" class="glossary-input" placeholder="Search term…" />
                    <div id="glossary-result" class="glossary-result">Type a term to see its definition.</div>
                </div>

                <!-- Block 2: TL;DR -->
                <div class="sidebar-block collapsible-item-sb">
                    <div class="collapsible-header-sb" style="padding: 0">
                        <h3 class="sidebar-section">TL;DR — Title</h3>
                        <span class="collapsible-icon">▸</span>
                    </div>

                    <div class="collapsible-content-sb" style="padding: 0 5px">
                        <ul class="no-bullet">
                            <li class="no-bullet">
                                <strong class="tldr-title">1 • Title</strong>
                                <div style="margin-left: 1em;">
                                    Description
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Block 3: Player & GM Resources -->
                <div class="sidebar-block">
                    <h3>Player & GM Resources</h3>
                    <a class="sidebar-link" href="#">GM Cheat Sheet</a>
                    <a class="sidebar-link" href="#">Quickstart Rules</a>
                </div>

                <!-- Block 4: From the Archives Carousel -->
                <div class="sidebar-block">
                    <h3>From the Archives</h3>
                    <div class="archives-carousel-fade">
                        <div class="archive-item show">
                            "They did not fear our steel, but the smoke that rose from southern ruins."
                            <div class="archive-author">— Letter from Inquisitor M. Varela, 1493</div>
                        </div>
                        <div class="archive-item">
                            "On the ninth night, the jungle sang back to us. Our torches would not stay lit."
                            <div class="archive-author">— Journal of Captain J. Strode</div>
                        </div>
                        <div class="archive-item">
                            "Blood on the pyramid steps opened a wound in the sky; we glimpsed something vast."
                            <div class="archive-author">— Testimony of Seeker L. de Rojas</div>
                        </div>
                        <div class="archive-item">
                            "The stone idols breathe. Some say they dream. Pray they never awaken."
                            <div class="archive-author">— Codex Margin Note, unknown author</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- FOOTER -->
    <div id="footer-bottom"></div>
    <script>
        fetch("/footer.html")
            .then(res => res.text())
            .then(html => {
                document.getElementById("footer-bottom").innerHTML = html;
            });
    </script>

    <!-- SCRIPTS ────────────────────────────────────────────────── -->
    <script>
        fetch('/sidenav.html')
            .then(res => res.text())
            .then(html => {
                document.getElementById('sidenav-container').innerHTML = html;

                const script = document.createElement('script');
                script.src = '/scripts/sidenav.js';
                document.body.appendChild(script);

                console.log(data);
                console.log(xpData);
            });
    </script>

    <script src="/scripts/sidebar.js"></script>
    <script src="/scripts/core.js"></script>
    <script src="/scripts/version-check.js"></script>
    <script src="/scripts/iconizer.js"></script>
    <script src="/scripts/parallax.js"></script>
    <script src="/scripts/carousel.js"></script>

    <script>
    // Collapsible initialization function
    function initCollapsibles() {
        const collapsibleItems = document.querySelectorAll(
            ".collapsible-item, .collapsible-item-sb"
        );

        collapsibleItems.forEach(item => {
            if (item.dataset.initialized) return; // evita doppia init
            const header = item.querySelector(
                ".collapsible-header, .collapsible-header-sb"
            );
            const content = item.querySelector(
                ".collapsible-content, .collapsible-content-sb"
            );
            const icon = item.querySelector(".collapsible-icon, .collapsible-icon-sb");

            if (!header || !content) return; // protezione

            content.style.height = "0px";

            header.addEventListener("click", () => {
                item.classList.toggle("expanded");
                icon?.classList.toggle("expanded-icon");

                if (item.classList.contains("expanded")) {
                    content.style.height = content.scrollHeight + "px";
                    content.classList.add("expanded-content");
                } else {
                    content.style.height = content.offsetHeight + "px";
                    requestAnimationFrame(() => {
                        content.style.height = "0px";
                    });
                    content.classList.remove("expanded-content");
                }

                content.addEventListener(
                    "transitionend",
                    function handler() {
                        if (item.classList.contains("expanded")) {
                            content.style.height = "auto";
                        }
                        content.removeEventListener("transitionend", handler, { once: true });
                    },
                    { once: true }
                );
            });

            item.dataset.initialized = "true";
        });
    }

    // Inizializza collapsible statici subito
    initCollapsibles();

    // Fetch e creazione tabelle
    fetch('/data/experience-points.json')
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById('tablesContainer');
            const xpData = data["experience-points-normal"];

            xpData.forEach(cat => {
                const collapsible = document.createElement('div');
                collapsible.className = 'collapsible-item';

                collapsible.innerHTML = `
                    <header class="collapsible-header" tabindex="0" role="button" aria-expanded="false"
                        style="background: linear-gradient(to right, rgba(var(--background-dark-1-rgb), .85), rgba(var(--background-dark-2-rgb), .98)), url('${cat.banner}')">
                        <span class="collapsible-title">${cat.category}</span>
                        <span class="collapsible-icon" aria-hidden="true"></span>
                    </header>
                    <div class="collapsible-content">
                        <table class="xp-table">
                            <thead>
                                <tr>
                                    <th>Event / Action</th>
                                    <th>CXP</th>
                                    <th>SXP</th>
                                    <th>EXP</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${cat.events.map(e => `
                                    <tr>
                                        <td>${e.event}</td>
                                        <td>${e.CXP ?? '—'}</td>
                                        <td>${e.SXP ?? '—'}</td>
                                        <td>${e.EXP ?? '—'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;

                container.appendChild(collapsible);
            });

            // Inizializza anche i collapsible creati dinamicamente
            initCollapsibles();
        })
        .catch(err => {
            console.error("Errore caricamento JSON:", err);
            // Continua comunque, così i collapsible statici funzionano
        });

    // Search + Filtri
    function applyFilters() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const checkedColumns = Array.from(document.querySelectorAll('#filters input:checked')).map(cb => cb.value);

        document.querySelectorAll('#tablesContainer .collapsible-item').forEach(item => {
            const tableRows = item.querySelectorAll('table tbody tr');
            let anyVisible = false;

            tableRows.forEach(row => {
                const textMatch = row.cells[0].textContent.toLowerCase().includes(searchTerm) || searchTerm === '';
                const columnMatch = checkedColumns.length === 0 || checkedColumns.some(col => row.querySelector(`td:nth-child(${colIndex(col)})`).textContent.trim() !== '—');

                if (textMatch && columnMatch) {
                    row.style.opacity = '1';
                    row.style.fontWeight = searchTerm ? 'bold' : 'normal';
                    anyVisible = true;
                } else {
                    row.style.opacity = '0.15';
                    row.style.fontWeight = 'normal';
                }
            });

            // Opacità header
            const header = item.querySelector('.collapsible-header');
                if (anyVisible) {
                    header.style.opacity = '1';
                    header.style.filter = 'drop-shadow(0 0 6px var(--ancient-gold)) drop-shadow(0 0 12px var(--ancient-gold))';
                } else {
                    header.style.opacity = '0.3';
                    header.style.filter = 'none';
                }
        });
    }

    function colIndex(col) {
        switch (col) {
            case 'CXP': return 2;
            case 'SXP': return 3;
            case 'EXP': return 4;
        }
    }

    document.getElementById('searchInput').addEventListener('input', applyFilters);
    document.querySelectorAll('#filters input').forEach(cb => cb.addEventListener('change', applyFilters));
</script>


</body>

</html>